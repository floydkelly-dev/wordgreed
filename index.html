<html lang="en">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Word Greed</title>
<link id="favicon" rel="icon" href="https://raw.githubusercontent.com/floydkelly-dev/wordgreed/main/public/WordGreedSiteIcon.png">

@@ -16,7 +16,6 @@
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-9BVWMWR6X5');
</script>

@@ -996,7 +995,7 @@ <h2 class="text-2xl font-bold text-amber-300 text-center">Your Riches</h2>
// It is now declared ONLY ONCE here.
const nonsenseFreebies = ['üå≠','ü•û','üçï','üçî','üçü','üçó','ü•†','üç©', 'üç∞', 'üç≠', 'üçã‚Äçüü©', 'üßã', 'üç∑', 'üç´', '‚òï', 'üç™'];
const wordBank = ["ABROAD","ACCEPT","ACCESS","ACROSS","ACTION","ACTIVE","ADMIRE","ADVICE","AFFAIR","AFFECT","AFFORD","AGENCY","AGENDA","ALMOST","ALWAYS","AMOUNT","ANIMAL","ANNUAL","ANSWER","ANYONE","ANYWAY","APART","APPEAL","APPEAR","APPLY","APPROVE","AROUND","ARRIVE","ARTIST","ASLEEP","ASPECT","ASSESS","ASSIST","ASSUME","ATTACK","ATTEND","ATTRACT","AUTHOR","AWARD","BALANCE","BECOME","BEHAVE","BELIEF","BELONG","BENEATH","BENEFIT","BESIDE","BEYOND","BISHOP","BORDER","BOTTLE","BOTTOM","BRANCH","BREATH","BRIDGE","BRIEFLY","BRIGHT","BROKEN","BUDGET","BURDEN","CAMERA","CANCEL","CANCER","CANDLE","CAPITAL","CAREER","CAREFUL","CENTRAL","CENTURY","CERTAIN","CHAIR","CHALLENGE","CHANCE","CHANGE","CHARGE","CHOICE","CHOOSE","CHURCH","CIRCLE","CLIENT","CLIMB","CLOSELY","CLOSER","COFFEE","COLLECT","COLLEGE","COLUMN","COMBINE","COMFORT","COMMAND","COMMENT","COMMIT","COMMON","COMPARE","COMPETE","COMPLEX","CONCEPT","CONCERN","CONFIRM","CONFLICT","CONNECT","CONSENT","CONSIST","CONTACT","CONTAIN","CONTENT","CONTEST","CONTEXT","CONTROL","CONVERT","CORNER","COUNCIL","COUNTY","COUPLE","COVER","CREATE","CREDIT","CRISIS","CRITERION","CRITIC","CROWD","CULTURE","CURRENT","CUSTOM","DAMAGE","DANGER","DEALER","DEBATE","DECADE","DECIDE","DECLARE","DECREASE","DEEPLY","DEFAULT","DEFENCE","DEFEND","DEFINE","DEGREE","DELAY","DELIVER","DEMAND","DEPEND","DEPICT","DEPOSIT","DEPUTY","DERIVE","DESIGN","DESIRE","DESPITE","DESTROY","DETAIL","DETECT","DEVELOP","DEVICE","DEVOTE","DIFFER","DIFFICULT","DINNER","DIRECT","DISCUSS","DISEASE","DISMISS","DISPLAY","DISTANT","DIVIDE","DIVISION","DOCTOR","DOCUMENT","DOUBLE","DOUBT","DOZEN","DREAM","DRINK","DRIVE","EAGER","EARLY","EARTH","EASTERN","ECONOMIC","ECONOMY","EDITOR","EDUCATE","EFFECT","EFFORT","EIGHT","EITHER","ELDERLY","ELECT","ELEMENT","ELSE","EMERGE","EMPHASIS","EMPLOY","ENABLE","ENCOURAGE","ENGINE","ENJOY","ENOUGH","ENSURE","ENTER","ENTIRE","ENTITLE","EQUALLY","EQUIP","ESCAPE","ESSAY","ESSENTIAL","ESTATE","ETHNIC","EVENT","EVERY","EXACTLY","EXAMINE","EXAMPLE","EXCEED","EXCEPT","EXCHANGE","EXCITE","EXCLUDE","EXCUSE","EXERCISE","EXIST","EXPECT","EXPENSE","EXPERIENCE","EXPERT","EXPLAIN","EXPLORE","EXPOSE","EXPRESS","EXTEND","EXTENT","EXTERNAL","EXTRA","EXTREME","FACTOR","FACULTY","FAILED","FAILURE","FAIRLY","FAITH","FAMLIAR","FAMOUS","FARMER","FASHION","FATHER","FAVOUR","FEELING","FEMALE","FIFTEEN","FIGHT","FIGURE","FINANCE","FINALLY","FINGER","FINISH","FLIGHT","FLOWER","FOLLOW","FOOTBALL","FORCE","FOREST","FORGET","FORMAL","FORMER","FORWARD","FOUND","FOURTH","FRAME","FREEDOM","FRIEND","FUNCTION","GARDEN","GATHER","GENERAL","GENERATION","GENTLE","GLOBAL","GOLDEN","GROUND","GROWTH","GUARD","GUILTY","HANDLE","HAPPEN","HARDLY","HEALTH","HEAVILY","HEIGHT","HENCE","HOLIDAY","HORSE","HOSPITAL","HOUSE","HOWEVER","HUMAN","HUSBAND","IMPACT","IMPLY","IMPORT","IMPOSE","IMPROVE","INCLUDE","INCREASE","INDEED","INDICATE","INDIVIDUAL","INDUSTRY","INFORM","INITIAL","INJURY","INSIDE","INSIST","INSTANCE","INSTEAD","INSTITUTE","INTEND","INTEREST","INTERNAL","INVOLVE","ISLAND","ISSUE","ITSELF","JOINT","JUDGE","JUDGMENT","JUNIOR","JUSTICE","LABOUR","LANGUAGE","LARGELY","LATTER","LAUGH","LAWYER","LEADER","LEAGUE","LEARN","LEAVE","LEGAL","LENGTH","LESSON","LETTER","LEVEL","LIBERAL","LIBRARY","LICENCE","LIMIT","LIMITED","LITTLE","LOCAL","LONDON","LONGER","MACHINE","MAJOR","MANAGE","MANAGER","MANNER","MANY","MARKET","MARRIAGE","MATCH","MATERIAL","MATTER","MEASURE","MEDIA","MEDICAL","MEETING","MEMBER","MEMORY","MENTAL","MENTION","MERELY","METHOD","MIDDLE","MIGHT","MILE","MILITARY","MINISTER","MINORITY","MINUTE","MISSION","MISTAKE","MODEL","MODERN","MODULE","MOMENT","MONEY","MONTH","MORAL","MORNING","MOTHER","MOTION","MOTOR","MOUNTAIN","MOUTH","MOVEMENT","MOVIE","MUCH","MUSIC","MYSELF","NARROW","NATION","NATIONAL","NATIVE","NATURAL","NATURE","NEARLY","NECESSARY","NEEDLE","NEITHER","NERVE","NETWORK","NEVER","NEWLY","NIGHT","NOBODY","NORMAL","NORTHERN","NOTICE","NOTION","NOWHERE","NUMBER","OBJECT","OBSERVE","OBTAIN","OBVIOUS","OCCASION","OCCUR","OFFENCE","OFFER","OFFICE","OFFICER","OFFICIAL","OFTEN","ONCE","ONLINE","ONLY","ONTO","OPENING","OPERATE","OPPORTUNITY","OPPOSE","OPPOSITE","ORDER","ORDINARY","ORGANISE","ORIGIN","ORIGINAL","OTHER","OUGHT","OUTCOME","OUTSIDE","OVERALL","OWNER","PACKAGE","PAINT","PANEL","PARENT","PARISH","PARLIAMENT","PARTLY","PARTNER","PARTY","PASSAGE","PATIENT","PATTERN","PEACE","PEOPLE","PERFORM","PERHAPS","PERIOD","PERMIT","PERSON","PERSONAL","PHONE","PHOTO","PHYSICAL","PICTURE","PIECE","PLACE","PLANNING","PLANT","PLASTIC","PLAYER","POCKET","POINT","POLICE","POLICY","POLITICAL","POLLUTION","POPULAR","POSITION","POSITIVE","POSSIBLE","POSTER","POWER","PRACTICE","PREFER","PREPARE","PRESENCE","PRESENT","PRESIDENT","PRESS","PRESSURE","PRETTY","PREVIOUS","PRICE","PRIMARY","PRINCIPLE","PRINT","PRIOR","PRIORITY","PRISON","PRIVATE","PROBABLY","PROBLEM","PROCEDURE","PROCESS","PRODUCE","PRODUCT","PROFESSION","PROFILE","PROFIT","PROGRAM","PROGRESS","PROJECT","PROMISE","PROMOTE","PROPER","PROPERTY","PROPOSE","PROTECT","PROVIDE","PUBLIC","PUBLISH","PURPOSE","PUSH","QUALITY","QUARTER","QUESTION","QUICKLY","QUITE","RAISE","RANGE","RAPIDLY","RATELY","RATHER","REACH","REACTION","READER","READING","READY","REALISE","REALLY","REASON","RECALL","RECEIVE","RECENT","RECENTLY","RECOGNISE","RECORD","RECOVER","REDUCE","REFER","REFLECT","REFORM","REFUSE","REGARD","REGION","REGIONAL","REGULAR","RELATE","RELATION","RELATIVE","RELEASE","RELEVANT","RELIEF","RELIGION","REMAIN","REMEMBER","REMOVE","REPEAT","REPLACE","REPLY","REPORT","REPRESENT","REQUEST","REQUIRE","RESEARCH","RESOURCE","RESPECT","RESPOND","RESPONSE","RESULT","RETAIN","RETURN","REVEAL","REVENUE","REVIEW","REVOLUTION","RIGHT","RING","RISE","ROAD","ROLE","ROOM","ROUND","ROUTE","ROYAL","RULE","SAFETY","SALE","SAME","SAMPLE","SAVE","SCALE","SCENE","SCHEME","SCHOOL","SCIENCE","SCORE","SCREEN","SEARCH","SEASON","SECOND","SECRETARY","SECTION","SECTOR","SECURE","SEEM","SELECT","SENIOR","SENSE","SENSITIVE","SENTENCE","SEPARATE","SEQUENCE","SERIES","SERIOUS","SERVANT","SERVICE","SESSION","SETTLE","SEVEN","SEVERAL","SEVERE","SHARE","SHEET","SHOOT","SHORT","SHOT","SHOULD","SHOULDER","SHOUT","SHOW","SIDE","SIGHT","SIGN","SIGNAL","SILENCE","SIMPLE","SIMPLY","SINCE","SINGLE","SISTER","SITE","SITUATION","SIZE","SKILL","SKIN","SLEEP","SLIGHTLY","SLOWLY","SOCIAL","SOCIETY","SOLDIER","SOLUTION","SOME","SOMEHOW","SOMEONE","SOMETHING","SOMETIMES","SOMEWHAT","SOON","SORRY","SORT","SOUND","SOURCE","SOUTHERN","SPACE","SPEAK","SPECIAL","SPECIFIC","SPEECH","SPEED","SPEND","SPIRIT","SPORT","SPOT","SPREAD","SPRING","SQUARE","STAFF","STAGE","STAND","STANDARD","START","STATE","STATEMENT","STATION","STATUS","STAY","STEP","STILL","STOCK","STONE","STOP","STORE","STORY","STRAIGHT","STRANGE","STRATEGY","STREET","STRENGTH","STRESS","STRIKE","STRONG","STRUCTURE","STUDY","STYLE","SUBJECT","SUBMIT","SUCCEED","SUCCESS","SUCH","SUDDENLY","SUFFER","SUGGEST","SUMMER","SUPPORT","SUPPOSE","SURELY","SURFACE","SURVEY","SURVIVE","SWITCH","SYSTEM","TABLE","TAKE","TALK","TARGET","TASK","TEACH","TEACHER","TEAM","TECHNOLOGY","TELEPHONE","TELEVISION","TEMPERATURE","TERM","TERRIBLE","TEST","THANKS","THEATRE","THEIR","THEME","THEMSELVES","THEN","THEORY","THERE","THESE","THEY","THING","THINK","THIRD","THIRTY","THIS","THOSE","THOUGH","THOUSAND","THREAT","THREATEN","THREE","THROUGH","THROW","TICKET","TIME","TITLE","TODAY","TOGETHER","TOMORROW","TONE","TONIGHT","TOTAL","TOTALLY","TOUCH","TOUR","TOWARDS","TOWN","TRADE","TRADITION","TRAFFIC","TRAIN","TRAINING","TRANSFER","TRANSPORT","TRAVEL","TREAT","TREATMENT","TREATY","TREE","TREND","TRIAL","TRIP","TROOP","TROUBLE","TRUE","TRUST","TRUTH","TWENTY","TWICE","TYPE","UNDER","UNDERSTAND","UNION","UNIQUE","UNIT","UNITED","UNIVERSITY","UNLESS","UNLIKE","UNTIL","UPON","UPPER","URBAN","USER","USUAL","USUALLY","VALLEY","VALUE","VARIETY","VARIOUS","VEHICLE","VERSION","VERY","VIDEO","VIEW","Village","VIOLENCE","VISION","VISIT","VISITOR","VOICE","VOLUME","VOTE","WAIT","WALK","WALL","WANT","WAR","WATCH","WATER","WAY","WEALTH","WEAPON","WEAR","WEATHER","WEEK","WEEKEND","WEIGHT","WELCOME","WELL","WESTERN","WHAT","WHATEVER","WHEN","WHERE","WHETHER","WHICH","WHILE","WHITE","WHOLE","WHOM","WHOSE","WIDE","WIDELY","WIFE","WILD","WILL","WINDOW","WINE","WINTER","WISH","WITHIN","WITHOUT","WOMAN","WONDER","WOOD","WORD","WORK","WORKER","WORLD","WORRY","WORTH","WOULD","WRITE","WRITER","WRONG","YARD","YEAR","YOUNG","YOURSELF","YOUTH","GRANTEE","STEAK","BEHAVES","FUNNY","HISTORY","FUTURE","CHANGES","GIFTS","FORGIVE"];
        const prizeEmojis = [ { emoji: 'üéÅ', value: 1500000, type: 'coins' }, { emoji: 'üèÜ', value: 3500000, type: 'trophy' }, { emoji: 'üíé', value: 20000000, type: 'diamond' }, { emoji: 'üí£', value: 0, type: 'game_over' }, { emoji: 'üí£', value: 0, type: 'green_bomb' }, { emoji: '‚≠ê', value: 5000, type: 'coins' }, { emoji: '‚ö°', value: 20000, type: 'lightning' }, { emoji: '‚ùÑÔ∏è', value: 0, type: 'freeze' }, { emoji: 'üî•', value: 400, type: 'fire_column'}, { emoji: 'üí∞', value: 1000000, type: 'cash_money' } ];
        const prizeEmojis = [ { emoji: 'üéÅ', value: 1500000, type: 'coins' }, { emoji: 'üèÜ', value: 3500000, type: 'trophy' }, { emoji: ' ', value: 20000000, type: 'diamond' }, { emoji: 'üí£', value: 0, type: 'game_over' }, { emoji: 'üí£', value: 0, type: 'green_bomb' }, { emoji: '‚≠ê', value: 5000, type: 'coins' }, { emoji: '‚ö°', value: 20000, type: 'lightning' }, { emoji: '‚ùÑÔ∏è', value: 0, type: 'freeze' }, { emoji: 'üî•', value: 400, type: 'fire_column'}, { emoji: 'üí∞', value: 1000000, type: 'cash_money' } ];
const puzzleLayouts = [ { length: 5, indices: [11, 12, 13, 14, 15] }, { length: 7, indices: [28, 29, 30, 31, 32, 33, 34] }, { length: 7, indices: [46, 47, 48, 49, 50, 51, 52] }, { length: 5, indices: [65, 66, 67, 68, 69] } ];
const trades = [
{ id: 'trade001', name: '10 üå≠ for 1 Food Truck', cost: { 'üå≠': 10 }, reward: { type: 'inventory', item: 'üöö', amount: 1 } },
@@ -2916,7 +2915,7 @@ <h2 class="text-2xl font-bold text-amber-300 text-center">Your Riches</h2>
tips.forEach((tip, index) => {
const card = document.createElement('div');
card.className = 'tip-card';
                card.textContent = tip;
                card.innerHTML = tip; // Use innerHTML to render bold/strong tags
if (index === currentTipIndex) {
card.classList.add('active');
}
@@ -2988,9 +2987,8 @@ <h2 class="text-2xl font-bold text-amber-300 text-center">Your Riches</h2>
const badgeEl = document.createElement('div');
badgeEl.className = 'badge-item';
badgeEl.textContent = badgeData.emoji;
                        // NEW: Add pulsating class for heart badge
if (badgeData.id === 'philanthropist') {
                            badgeEl.classList.add('heart-badge-pulse');
                            badgeEl.classList.add('heart-pulse');
}
panel.appendChild(badgeEl);
}
@@ -3092,14 +3090,10 @@ <h4 class="font-bold text-lg">${isUnlocked ? badge.name : '???'}</h4>

// --- FIREBASE: Main Initialization and Auth Flow ---
async function initGame() {
            // Step 1: Initialize the game with default data. This makes the UI load instantly.
playerData = getDefaultPlayerData("offline");
applyTheme(playerData.activeSkin);
populateSetupModal();
displayBadges();

            // Step 2: Set up the rest of the game logic that doesn't depend on player data.
            for (let i = 0; i < wordBank.length; i++) { wordBank[i] = wordBank[i].toUpperCase(); }
await buildVerifiedPlaylist();
if (userPlaylist.length > 0) { currentTrackIndex = Math.floor(Math.random() * userPlaylist.length); }
musicPlayer.addEventListener('ended', playNextTrack);
@@ -3124,22 +3118,17 @@ <h4 class="font-bold text-lg">${isUnlocked ? badge.name : '???'}</h4>
setTimeout(() => coin.remove(), 5000);
}, 300);

            // Step 3: Attempt to connect to Firebase.
try {
                // The 'firebaseConfig' object is injected by Netlify.
if (typeof firebaseConfig === 'undefined' || !firebaseConfig.apiKey) {
throw new Error("Firebase config not found. Running in offline mode.");
}

                // Initialize Firebase services
const app = firebase.initializeApp(firebaseConfig);
auth = firebase.auth();
db = firebase.firestore();

                // Set up the authentication state listener. This is the core of the connection logic.
auth.onAuthStateChanged(async (user) => {
if (user) {
                        // A user is signed in (either returning or newly anonymous).
userId = user.uid;
isFirebaseConnected = true;
console.log("Player authenticated with userId:", userId);
@@ -3148,22 +3137,18 @@ <h4 class="font-bold text-lg">${isUnlocked ? badge.name : '???'}</h4>
const playerDocSnap = await playerDocRef.get();

if (playerDocSnap.exists()) {
                            // This is a returning player. Load their data.
playerData = playerDocSnap.data();
console.log("Existing player data loaded from Firestore:", playerData);
} else {
                            // This is a new player. Create their default document in Firestore.
console.log("New player detected. Creating document in Firestore...");
playerData = getDefaultPlayerData(userId);
                            await savePlayerProfile(); // This performs the initial save.
                            await savePlayerProfile();
}
} else {
                        // No user is signed in. Attempt to sign in anonymously.
console.log("No active user. Signing in anonymously...");
await auth.signInAnonymously();
}

                    // Step 4: Once data is loaded/created, update the entire UI.
playerNameInput.placeholder = "Enter Name";
applyTheme(playerData.activeSkin);
populateSetupModal();
@@ -3175,7 +3160,7 @@ <h4 class="font-bold text-lg">${isUnlocked ? badge.name : '???'}</h4>
playerNameInput.placeholder = "Enter Name";
}

            // --- FIREBASE: Global Event Listeners (Refactored) ---
            // --- Global Event Listeners ---
document.getElementById('start-game-button').addEventListener('click', startGame);
document.getElementById('play-again-button').addEventListener('click', restartGame);
document.getElementById('help-button').addEventListener('click', () => {
@@ -3220,24 +3205,13 @@ <h4 class="font-bold text-lg">${isUnlocked ? badge.name : '???'}</h4>
document.getElementById('confirm-reset-modal').classList.add('hidden');
});
document.getElementById('confirm-reset-button').addEventListener('click', async () => {
                playerData = getDefaultPlayerData(userId); // Reset with the current user's ID.
                await savePlayerProfile(); // This will overwrite the cloud data with a fresh start.
                playerData = getDefaultPlayerData(userId);
                await savePlayerProfile();
populateSetupModal();
applyTheme('default');
displayBadges();
document.getElementById('confirm-reset-modal').classList.add('hidden');
});
            document.querySelectorAll('.difficulty-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    document.querySelectorAll('.difficulty-button').forEach(btn => btn.classList.remove('difficulty-active'));
                    const clickedButton = e.currentTarget;
                    clickedButton.classList.add('difficulty-active');
                    if (clickedButton.id === 'difficulty-easy') maxSameEmoji = 8;
                    else if (clickedButton.id === 'difficulty-medium') maxSameEmoji = 4;
                    else if (clickedButton.id === 'difficulty-hard') maxSameEmoji = 2;
                    else maxSameEmoji = 4;
                });
            });
document.getElementById('daily-rewards-button').addEventListener('click', () => {
document.getElementById('help-modal').classList.add('hidden');
populateCalendar();
@@ -3251,7 +3225,7 @@ <h4 class="font-bold text-lg">${isUnlocked ? badge.name : '???'}</h4>
document.getElementById('execute-trade-button').addEventListener('click', executeTrade);
document.getElementById('close-trading-post-button').addEventListener('click', () => {
document.getElementById('trading-post-modal').classList.add('hidden');
                populateSetupModal(); // Refresh setup modal on close
                populateSetupModal();
document.getElementById('setup-modal').classList.remove('hidden');
});
document.getElementById('riches-button').addEventListener('click', () => {
@@ -3261,7 +3235,7 @@ <h4 class="font-bold text-lg">${isUnlocked ? badge.name : '???'}</h4>
});
document.getElementById('close-riches-button').addEventListener('click', () => {
document.getElementById('riches-modal').classList.add('hidden');
                populateSetupModal(); // Refresh setup modal on close
                populateSetupModal();
document.getElementById('setup-modal').classList.remove('hidden');
});
document.getElementById('player-name-input').addEventListener('blur', (e) => {
@@ -3336,11 +3310,10 @@ <h4 class="font-bold text-lg">${isUnlocked ? badge.name : '???'}</h4>
document.body.removeChild(textArea);
}
});
            // Giving Modal Listeners
document.getElementById('give-button').addEventListener('click', openGivingModal);
document.getElementById('close-giving-button').addEventListener('click', () => {
document.getElementById('giving-modal').classList.add('hidden');
                populateTradingPost(); // Refresh trading post on close
                populateTradingPost();
document.getElementById('trading-post-modal').classList.remove('hidden');
});
document.getElementById('execute-give-button').addEventListener('click', executeGive);